function c(e){return new Promise(o=>{chrome.tabs.onUpdated.addListener(function r(n,t){n===e&&t.status==="complete"&&(chrome.tabs.onUpdated.removeListener(r),o())})})}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"xsv-reader-open-with",title:chrome.i18n.getMessage("contextMenuOpenWith"),contexts:["link"]})});chrome.contextMenus.onClicked.addListener(async(e,o)=>{const r="background / contextMenus / onClicked";if(e.menuItemId==="xsv-reader-open-with"){console.log(r,e);try{const t=await(await fetch(e.linkUrl)).text();console.log(r,t);const s=await chrome.tabs.create({url:chrome.runtime.getURL("index.html?mode=url")});await c(s.id),chrome.tabs.sendMessage(s.id,{command:"set-url-content",content:t})}catch(n){console.error(r,n)}}});chrome.runtime.onMessage.addListener(async(e,o,r)=>{const n="background / onMessage";if(console.log(n,e),e.command==="open-file-parse")try{const{content:t,separatorCurrentId:s}=e,a=await chrome.tabs.create({url:chrome.runtime.getURL("index.html?mode=url")});await c(a.id),chrome.tabs.sendMessage(a.id,{command:"set-url-content",content:t,separatorCurrentId:s})}catch(t){console.error(n,t)}});chrome.runtime.onInstalled.addListener(async e=>{e.reason===chrome.runtime.OnInstalledReason.INSTALL&&await chrome.tabs.create({url:"https://csvviewer.tilda.ws/"})});chrome.runtime.setUninstallURL("https://forms.gle/jifX1fVSB1Yc5w7H6");
